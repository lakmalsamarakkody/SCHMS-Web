{{ template.header|raw }}

<body>

    <div class="container-fluid home">
        <div class="row">
            
            {{ template.sidenav|raw }}

            <div class="col-md-10 content">
                
                {{ template.topmenu|raw }}

                <!-- START : BUTTON TRIGGER MODAL -->
                <!-- END : BUTTON TRIGGER MODAL -->

                <!-- START : EXAM CREATE PAGE -->
                <div class="container examcreate">

                    <!-- START : ADD EXAM -->
                    <div class="addexam">

                        <div class="d-flex align-middle" style="justify-content: space-between;margin-top: 1rem;">
                            <h4 class="page-title mt-0"> Create an Exam </h4>

                            <div class="">
                                <button type="button" class="btn btn-sm btn-warning ml-auto" data-toggle="modal" data-target="#edit-exam"> Edit / Remove exam </button>
                                <button type="button" class="btn btn-sm btn-warning ml-2" data-toggle="modal" data-target="#view-exam-type"> Edit / Remove exam type </button>
                                <button type="button" class="btn btn-sm btn-primary ml-2"  data-toggle="modal" data-target="#create-exam-type"> Add new exam type </button>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <!-- START : EXAM CREATE FORM -->
                                <form method="post">

                                    <div class="form-row">

                                        <div class="col-1">
                                            <div class="form-group">
                                                <label for="examyear"> Year </label>
                                                <select id="examyear" class="form-control">
                                                    <option selected disabled> - Select - </option>
                                                    {% for year in years %}
                                                        <option value="{{ year }}"> {{ year }} </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-2">
                                            <div class="form-group">
                                                <label for="examtype"> Exam type </label>
                                                <select class="form-control" id="examtype">
                                                    <option selected disabled> - Select Exam Type - </option>
                                                    {% for exam_type in exam_types %}
                                                        <option value="{{ exam_type.id }}"> {{ exam_type.name }} </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-2">
                                            <div class="form-group">
                                                <label for="venue"> Venue </label>
                                                <input type="text" class="form-control" id="venue"/>
                                            </div>
                                        </div>

                                        <div class="col-7">
                                            <div class="form-group">
                                                <label for="exam_instructions"> Instructions </label>
                                                <textarea class="md-textarea form-control" id="exam_instructions" rows="1" placeholder="type exam instructions here.."></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="col-12 mt-2">
                                            <div class="form-group ml-auto">
                                                <button type="button" class="btn btn-primary" onclick="create_exam();"> Create exam </button>
                                            </div>
                                        </div>

                                    </div>

                                </form>
                            </div>
                        </div> 
                        <!-- END : EXAM CREATE FORM -->
                    </div>
                    <!-- END : ADD EXAM -->

                    <!-- START : SCHEDULE EXAM -->
                    <div class="scheduleexam">

                        <h4 class="page-title mt-5"> Schedule an exam </h4>

                        <div class="card mt-4">
                            <div class="card-body">
                                <form method="post">

                                    <div class="form-row mt-4">

                                        <div class="col-4">
                                            <div class="form-group">
                                                <label for="exam"> Select Exam </label>
                                                <select class="form-control" id="exam_name">
                                                    <option selected disabled> - Select Exam - </option>
                                                    {% for exam in exams %}
                                                        <option value="{{ exam.id }}"> {{ exam.type.name }} - {{ exam.year }} </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-4">
                                            <div class="form-group">
                                                <label for="grade"> Grade </label>
                                                <select class="form-control" id="exam_grade">
                                                    <option selected disabled> - Select Grade - </option>
                                                    {% for grade in grades %}
                                                        <option value="{{ grade.id }}"> {{ grade.name }} </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-4">
                                            <div class="form-group">
                                                <label for="subject"> Subject </label>
                                                <select class="form-control" id="exam_subject">
                                                    <option selected disabled> - Select Subject - </option>
                                                    {% for subject in subjects %}
                                                        <option value="{{ subject.id }}"> {{ subject.name }} </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-3">
                                            <div class="form-group">
                                                <label for="date"> Date </label>
                                                <input type="date" class="form-control" id="exam_date" min="{{ exam_min_date }}" max="{{ exam_max_date }}"></select>
                                            </div>
                                        </div>

                                        <div class="col-3">
                                            <div class="form-group">
                                                <label for="starttime"> Start time </label>
                                                <input type="time" id="exam_starttime" class="form-control"/>
                                                <!-- <div class="input-group date" id="starttimepicker" data-target-input="nearest">
                                                    <input type="time" id="starttime" name="time" placeholder="hrs:mins" pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$" class="form-control"/>
                                                    <input type="text" id="starttime" class="form-control datetimepicker-input" data-target="#starttimepicker"/>
                                                    <div class="input-group-append" data-target="#starttimepicker" data-toggle="datetimepicker">
                                                        <div class="input-group-text"><i class="la la-clock-o"></i></div>
                                                    </div>
                                                </div> -->
                                            </div>
                                        </div>

                                        <div class="col-3">
                                            <div class="form-group">
                                                <label for="endtime"> End time </label>
                                                <input type="time" id="exam_endtime" class="form-control"/>
                                                <!-- <div class="input-group date" id="endtimepicker" data-target-input="nearest">
                                                    <input type="text" id="endtime" class="form-control datetimepicker-input" data-target="#endtimepicker"/>
                                                    <div class="input-group-append" data-target="#endtimepicker" data-toggle="datetimepicker">
                                                        <div class="input-group-text"><i class="la la-clock-o"></i></div>
                                                    </div>
                                                </div> -->
                                            </div>
                                        </div>

                                        <div class="col-3">
                                            <div class="form-group">
                                                <label for="subject_exam_venue"> Venue </label>
                                                <input type="text" id="subject_exam_venue" class="form-control" maxlength="50"/>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="subject_exam_instructions"> Instructions </label>
                                                <textarea class="md-textarea form-control" rows="5" id="subject_exam_instructions"></textarea>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-group ml-auto">
                                                <button type="button" class="btn btn-primary" onClick="add_schedule();"> Add Schedule </button>
                                            </div>
                                        </div>

                                    </div>
                                   

                                </form>
                            </div>
                        </div>

                    </div>
                    <!-- END : SCHEDULE EXAM -->

                </div>
                <!-- END : EXAM CREATE PAGE  -->

            </div>
            
        </div>
    </div>

    {{ template.footer|raw }}

    <!-- START : MODAL CREATE EXAM-TYPE -->
    <div class="modal fade" id="create-exam-type" tabindex="-1" role="dialog" aria-labelledby="create-exam-type-title" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="create-exam-type-title"> Enter new exam type </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="exam_type"> Exam Type Name </label>
                            <input type="text" class="form-control" id="exam_type"/>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="addexam_type();"> Save changes </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- END : MODAL CREATE EXAM-TYPE -->

    <!-- START : MODAL EDIT/REMOVE EXAM-TYPE -->
    <div class="modal fade" id="view-exam-type" tabindex="-1" role="dialog" aria-labelledby="view-exam-type-title" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="view-exam-type-title"> Edit exam types </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">

                    <table class="table table-hover table-responsive-md">

                        <thead class="thead-dark">
                            <tr>
                                <th width="5%" class="text-center" scope="col">ID</th>
                                <th scope="col">Exam Type Name</th>
                                <th width="20%" class="text-center" scope="col">&nbsp;</th>                                            
                            </tr>
                        </thead>

                        <tbody>
                            {% for exam_type in exam_types %}
                                <tr>
                                    <th class="text-center" scope="row">{{ exam_type.id }}</th>
                                    <td>{{ exam_type.name }}</td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-xs btn-warning">edit</button> 
                                        <button type="button" class="btn btn-xs btn-danger">remove</button> 
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>

                    </table>

                </div>

            </div>
        </div>
    </div>
    <!-- END : MODAL EDIT/REMOVE EXAM-TYPE -->

    <!-- START : MODAL EDIT/REMOVE EXAM -->
    <div class="modal fade" id="edit-exam" tabindex="-1" role="dialog" aria-labelledby="edit-exam-title" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="edit-exam-title"> Edit / Remove Exams </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form>
                    <div class="modal-body">

                        <table class="table table-hover table-responsive-md">

                            <thead class="thead-dark">
                                <tr>
                                    <th width="1%" class="text-center" scope="col">ID</th>
                                    <th width="20%" scope="col">Exam Name</th>
                                    <th width="30%" scope="col">Venue</th>
                                    <th scope="col">Instructions</th>
                                    <th width="12%" class="text-center" scope="col">&nbsp;</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for exam in exams %}
                                    <tr>
                                        <th class="text-center" scope="row">{{ exam.id }}</th>
                                        <td>{{ exam.type.name }} - {{ exam.year }}</td>
                                        <td>{{ exam.venue }}</td>
                                        <td>{{ exam.instructions }}</td>
                                        <td class="text-center">
                                            <button type="button" class="btn btn-xs btn-warning" onclick="exam.edit({{ exam.id }});" >edit</button> 
                                            <button type="button" class="btn btn-xs btn-danger" onclick="exam.remove({{ exam.id }});">remove</button> 
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>

                        </table>
                        
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- END : MODAL EDIT/REMOVE EXAM -->

    <script>

        // START : SCRIPT FOR REMOVE EXAM
        var exam = {

            edit: (examId) => {

                var formData = new FormData;
                formData.append("exam_id", examId)

                $.ajax({
                    url: "{{ app.url }}/exam/ajax_edit_exam",
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    success: (res) => {
                        
                        if ( res.status == 'success' ) {
                            alertify.alert("Success", "Exam data edited successfully ... ").set('onok', function() {
                                location.reload();
                            })
                        } else {
                            console.log(res);
                            alertify.alert(res.error);
                        }
                    },
                    error: (e) => {
                        alertify.alert("Error", "Something went wrong ... ");
                        console.log(e.responseText)
                    }
                })
            },

            remove: (examId) => {

                var formData = new FormData;
                formData.append("exam_id", examId)

                $.ajax({
                    url: "{{ app.url }}/exam/ajax_remove_exam",
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    success: (res) => {
                        
                        if ( res.status == 'success' ) {
                            alertify.alert("Success", "Exam removed successfully ... ").set('onok', function() {
                                location.reload();
                            })
                        } else {
                            console.log(res);
                            alertify.alert(res.message);
                        }
                    },
                    error: (e) => {
                        alertify.alert("Error", "Something went wrong ... ");
                        console.log(e.responseText)
                    }
                })
                
            }
        }
        // END : SCRIPT FOR REMOVE EXAM
    
        // START : SCRIPT : ADD A EXAM_TYPE
        addexam_type = () => {

            // PAYLOAD
            var formData = new FormData;

            // ADD CLASS DATA
            formData.append('exam_type_name', $("#exam_type").val())

            // REQUEST
            $.ajax({
                url: "{{ app.url }}/school/ajax_addexam_type",
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'json',
                success: (res) => {
                    
                    if ( res.status == 'success' ) {
                        alertify.alert("Success", "Exam Type added successfully ... ").set('onok', function() {
                            location.reload();
                        })
                    } else {
                        console.log(res);
                        alertify.alert(res.error);
                    }
                },
                error: (e) => {
                    alertify.alert("Error", "Something went wrong ... ");
                    console.log(e.responseText)
                }
            })
        }
        // END : SCRIPT : ADD A EXAM_TYPE

        // START : SCRIPT : CREATE EXAM
        create_exam = () => {

            // PAYLOAD
            var formData = new FormData;

            // ADD EXAM DATA
            formData.append('exam_type', $("#examtype").val())
            formData.append('exam_year', $("#examyear").val())
            formData.append('exam_venue', $("#venue").val())
            formData.append('exam_instructions', $("#exam_instructions").val())
            
            // REQUEST
            $.ajax({
                url: "{{ app.url }}/exam/ajax_create_exam",
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'json',
                success: (res) => {
                    
                    if ( res.status == 'success' ) {
                        alertify.alert("Success", "Exam created successfully ... ").set('onok', function() {
                            location.reload();
                        })
                    } else {
                        console.log(res);
                        alertify.alert(res.error);
                    }
                },
                error: (e) => {
                    alertify.alert("Error", "Something went wrong ... ");
                    console.log(e.responseText)
                }
            })
        }
        // END : SCRIPT : CREATE EXAM

        // START : SCRIPT : ADD EXAM SCHEDULE
        add_schedule = () => {

            // PAYLOAD
            var formData = new FormData;

            // ADD EXAM SCHEDULE DATA
            formData.append('select_exam_name', $("#exam_name").val())
            formData.append('exam_grade', $("#exam_grade").val())
            formData.append('exam_subject_name', $("#exam_subject").val())
            formData.append('exam_date', $("#exam_date").val())
            formData.append('exam_starttime', $("#exam_starttime").val())
            formData.append('exam_endtime', $("#exam_endtime").val())
            formData.append('subject_exam_venue', $("#subject_exam_venue").val())
            formData.append('subject_exam_instructions', $("#subject_exam_instructions").val())

            // REQUEST
            $.ajax({
                url: "{{ app.url }}/exam/ajax_add_schedule",
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'json',
                success: (res) => {
                    
                    if ( res.status == 'success' ) {
                        alertify.alert("Success", "Exam subject schedule created successfully ... ").set('onok', function() {
                            location.reload();
                        })
                    } else {
                        console.log(res);
                        alertify.alert(res.error);
                    }
                },
                error: (e) => {
                    alertify.alert("Error", "Something went wrong ... ");
                    console.log(e.responseText)
                }
            })
        }
        // END : SCRIPT : ADD EXAM SCHEDULE

    </script>

    <script type="text/javascript">
        $(function () {
            $('#starttimepicker').datetimepicker({
                format: 'hh:mm',
                icons: {
                    time: "la la-clock-o",
                    date: "la la-calendar",
                    up: "la la-angle-up",
                    down: "la la-angle-down"
                }
            });

            $('#endtimepicker').datetimepicker({
                format: 'LT',
                icons: {
                    time: "la la-clock-o",
                    date: "la la-calendar",
                    up: "la la-angle-up",
                    down: "la la-angle-down"
                }
            });
        });
    </script>

</body>